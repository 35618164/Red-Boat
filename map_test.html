<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å—æ¹–çºªå¿µé¦†åœ°å›¾é›†æˆæµ‹è¯•</title>
    
    <!-- Leaflet åœ°å›¾åº“ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- æ ·å¼ -->
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        #map { height: 500px; width: 100%; border: 2px solid #007bff; border-radius: 8px; }
        .controls { margin: 20px 0; }
        .btn { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        .info-panel { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px; }
        .route-info { background: #e7f3ff; padding: 10px; border-left: 4px solid #007bff; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ—ºï¸ å—æ¹–çºªå¿µé¦†æ™ºèƒ½åœ°å›¾å¯¼èˆªç³»ç»Ÿæµ‹è¯•</h1>
    
    <div class="controls">
        <button class="btn" onclick="showMemorialArea()">ğŸ“ å®šä½çºªå¿µé¦†</button>
        <button class="btn" onclick="showIndoorMap()">ğŸ›ï¸ å®¤å†…åœ°å›¾</button>
        <button class="btn" onclick="planRoute()">ğŸ—ºï¸ è§„åˆ’è·¯çº¿</button>
        <button class="btn" onclick="showExhibits()">ğŸ¨ å±•ç¤ºå±•å“</button>
    </div>
    
    <!-- åœ°å›¾å®¹å™¨ -->
    <div id="map"></div>
    
    <!-- ä¿¡æ¯é¢æ¿ -->
    <div class="info-panel">
        <h3>ğŸ“Š åœ°å›¾ä¿¡æ¯</h3>
        <div id="map-info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•ä¸åŒçš„åœ°å›¾åŠŸèƒ½...</div>
    </div>
    
    <script>
        // åˆå§‹åŒ–åœ°å›¾
        var map = L.map('map').setView([30.7617, 120.0106], 15);
        
        // æ·»åŠ OpenStreetMapå›¾å±‚
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors | å—æ¹–çºªå¿µé¦†æ™ºèƒ½å¯¼èˆªç³»ç»Ÿ',
            maxZoom: 19
        }).addTo(map);
        
        // çºªå¿µé¦†ä½ç½®æ ‡è®°
        var memorialMarker = L.marker([30.7617, 120.0106]).addTo(map)
            .bindPopup('<b>ğŸ›ï¸ å—æ¹–çºªå¿µé¦†</b><br>ä¸­å›½å…±äº§å…šçš„è¯ç”Ÿåœ°');
        
        // æ¨¡æ‹Ÿå±•å“ä½ç½®æ•°æ®
        var exhibits = [
            {name: "ä¸­å…±ä¸€å¤§ä¼šå€", lat: 30.7617, lng: 120.0106, type: "ä¼šè®®", description: "ä¸­å›½å…±äº§å…šç¬¬ä¸€æ¬¡å…¨å›½ä»£è¡¨å¤§ä¼šä¼šå€"},
            {name: "çº¢èˆ¹æ¨¡å‹", lat: 30.7620, lng: 120.0108, type: "æ¨¡å‹", description: "ä¸­å…±ä¸€å¤§é—­å¹•ä¼šè®®ä¸¾è¡Œåœ°çº¢èˆ¹å¤åˆ¶æ¨¡å‹"},
            {name: "å…šç« å±•ç¤º", lat: 30.7615, lng: 120.0104, type: "æ–‡çŒ®", description: "å†å±Šå…šç« å‘å±•å†ç¨‹å±•ç¤º"},
            {name: "é©å‘½æ–‡ç‰©", lat: 30.7622, lng: 120.0110, type: "æ–‡ç‰©", description: "æ—©æœŸé©å‘½æ´»åŠ¨ç›¸å…³æ–‡ç‰©"},
            {name: "å†å²ç…§ç‰‡", lat: 30.7614, lng: 120.0102, type: "ç…§ç‰‡", description: "çè´µå†å²ç…§ç‰‡é›†é”¦"},
            {name: "é¢†è¢–é¢˜è¯", lat: 30.7625, lng: 120.0112, type: "ä¹¦æ³•", description: "é‡è¦é¢†å¯¼äººé¢˜è¯å¢¨å®"},
            {name: "å¤šåª’ä½“å±•ç¤º", lat: 30.7618, lng: 120.0115, type: "å¤šåª’ä½“", description: "ç°ä»£ç§‘æŠ€å±•ç¤ºå†å²"},
            {name: "äº’åŠ¨ä½“éªŒåŒº", lat: 30.7627, lng: 120.0118, type: "äº’åŠ¨", description: "æ²‰æµ¸å¼å†å²ä½“éªŒ"}
        ];
        
        // å±•å“æ ‡è®°æ•°ç»„
        var exhibitMarkers = [];
        var routePolyline = null;
        
        // å®šä½çºªå¿µé¦†åŠŸèƒ½
        function showMemorialArea() {
            map.setView([30.7617, 120.0106], 18);
            memorialMarker.openPopup();
            updateInfo("ğŸ“ å·²å®šä½åˆ°å—æ¹–çºªå¿µé¦†ä¸»å»ºç­‘");
        }
        
        // æ˜¾ç¤ºå®¤å†…åœ°å›¾åŠŸèƒ½
        function showIndoorMap() {
            // æ¸…é™¤ä¹‹å‰çš„æ ‡è®°
            exhibitMarkers.forEach(marker => map.removeLayer(marker));
            exhibitMarkers = [];
            
            // æ·»åŠ å±•å“æ ‡è®°
            exhibits.forEach((exhibit, index) => {
                var icon = getExhibitIcon(exhibit.type);
                var marker = L.marker([exhibit.lat, exhibit.lng], {icon: icon})
                    .bindPopup(`<b>${exhibit.name}</b><br>ç±»å‹: ${exhibit.type}<br>${exhibit.description}`)
                    .addTo(map);
                exhibitMarkers.push(marker);
            });
            
            map.setView([30.7617, 120.0106], 19);
            updateInfo(`ğŸ›ï¸ å·²åŠ è½½ ${exhibits.length} ä¸ªå±•å“ä½ç½®ï¼Œç‚¹å‡»åœ°å›¾æ ‡è®°æŸ¥çœ‹è¯¦æƒ…`);
        }
        
        // è·¯çº¿è§„åˆ’åŠŸèƒ½
        function planRoute() {
            if (exhibitMarkers.length === 0) {
                showIndoorMap();
            }
            
            // æ¸…é™¤ä¹‹å‰çš„è·¯çº¿
            if (routePolyline) {
                map.removeLayer(routePolyline);
            }
            
            // åˆ›å»ºæ¨¡æ‹Ÿè·¯çº¿ï¼ˆç®€åŒ–çš„TSPè·¯å¾„ï¼‰
            var routePoints = [
                [30.7617, 120.0106], // èµ·ç‚¹
                [30.7620, 120.0108], // çº¢èˆ¹æ¨¡å‹
                [30.7622, 120.0110], // é©å‘½æ–‡ç‰©
                [30.7625, 120.0112], // é¢†è¢–é¢˜è¯
                [30.7627, 120.0118], // äº’åŠ¨ä½“éªŒåŒº
                [30.7618, 120.0115], // å¤šåª’ä½“å±•ç¤º
                [30.7615, 120.0104], // å…šç« å±•ç¤º
                [30.7614, 120.0102], // å†å²ç…§ç‰‡
                [30.7617, 120.0106]  // å›åˆ°èµ·ç‚¹
            ];
            
            // ç»˜åˆ¶è·¯çº¿
            routePolyline = L.polyline(routePoints, {
                color: '#ff0000',
                weight: 4,
                opacity: 0.8,
                dashArray: '10, 5'
            }).addTo(map);
            
            // æ·»åŠ è·¯çº¿æ–¹å‘ç®­å¤´
            routePoints.forEach((point, index) => {
                if (index < routePoints.length - 1) {
                    L.circle(point, {
                        radius: 3,
                        color: '#ff0000',
                        fillColor: '#ff0000',
                        fillOpacity: 0.8
                    }).addTo(map);
                }
            });
            
            // è®¡ç®—è·¯çº¿ä¿¡æ¯
            var totalDistance = calculateRouteDistance(routePoints);
            var estimatedTime = Math.round(totalDistance * 100 + 30); // æ¨¡æ‹Ÿå‚è§‚æ—¶é—´
            
            updateInfo(`ğŸ—ºï¸ è·¯çº¿è§„åˆ’å®Œæˆï¼<br>
                <div class="route-info">
                    ğŸ“ æ€»è·ç¦»: ${totalDistance.toFixed(0)}ç±³<br>
                    â±ï¸ é¢„è®¡æ—¶é—´: ${estimatedTime}åˆ†é’Ÿ<br>
                    ğŸ¯ åŒ…å«å±•å“: ${exhibits.length}ä¸ª<br>
                    ğŸ“ è·¯çº¿ç±»å‹: æ™ºèƒ½ä¼˜åŒ–è·¯çº¿
                </div>`);
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰å±•å“
        function showExhibits() {
            showIndoorMap();
            
            var exhibitList = exhibits.map(e => `â€¢ ${e.name} (${e.type})`).join('<br>');
            updateInfo(`ğŸ¨ å±•å“åˆ—è¡¨:<br>${exhibitList}`);
        }
        
        // è·å–å±•å“å›¾æ ‡
        function getExhibitIcon(type) {
            var icons = {
                'ä¼šè®®': 'ğŸ›ï¸',
                'æ¨¡å‹': 'ğŸš¢',
                'æ–‡çŒ®': 'ğŸ“œ',
                'æ–‡ç‰©': 'ğŸº',
                'ç…§ç‰‡': 'ğŸ“¸',
                'ä¹¦æ³•': 'ğŸ–‹ï¸',
                'å¤šåª’ä½“': 'ğŸ“º',
                'äº’åŠ¨': 'ğŸ®'
            };
            
            return L.divIcon({
                html: `<div style="background: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border: 2px solid #007bff; font-size: 16px;">${icons[type] || 'ğŸ“'}</div>`,
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });
        }
        
        // è®¡ç®—è·¯çº¿è·ç¦»
        function calculateRouteDistance(points) {
            var totalDistance = 0;
            for (var i = 0; i < points.length - 1; i++) {
                var p1 = L.latLng(points[i]);
                var p2 = L.latLng(points[i + 1]);
                totalDistance += p1.distanceTo(p2);
            }
            return totalDistance;
        }
        
        // æ›´æ–°ä¿¡æ¯é¢æ¿
        function updateInfo(message) {
            document.getElementById('map-info').innerHTML = message;
        }
        
        // åœ°å›¾ç‚¹å‡»äº‹ä»¶
        map.on('click', function(e) {
            console.log(`ç‚¹å‡»ä½ç½®: ${e.latlng.lat}, ${e.latlng.lng}`);
        });
        
        // åˆå§‹åŒ–ä¿¡æ¯
        updateInfo("ğŸ—ºï¸ åœ°å›¾å·²åŠ è½½å®Œæˆï¼Œä½¿ç”¨OpenStreetMapæ•°æ®<br>ğŸ“ å½“å‰ä½ç½®: å—æ¹–çºªå¿µé¦†åŒºåŸŸ");
        
        // æµ‹è¯•APIè¿æ¥
        console.log('ğŸš€ å—æ¹–çºªå¿µé¦†åœ°å›¾ç³»ç»Ÿå·²å¯åŠ¨');
        console.log('ğŸ“Š ä½¿ç”¨æ•°æ®æº: OpenStreetMap');
        console.log('ğŸ¯ æ”¯æŒåŠŸèƒ½: å®¤å†…å¯¼èˆªã€è·¯çº¿è§„åˆ’ã€å±•å“å®šä½');
    </script>
</body>
</html>
